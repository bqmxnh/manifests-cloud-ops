apiVersion: argoproj.io/v1alpha1
kind: CronWorkflow
metadata:
  name: arf-ids-incremental-retrain
  namespace: argo
spec:
  schedule: "{{ .Values.retrain.schedule }}"
  concurrencyPolicy: Forbid

  workflowSpec:
    entrypoint: retrain

    templates:
      - name: retrain
        container:
          image: "{{ .Values.retrain.image.repository }}:{{ .Values.retrain.image.tag }}"
          imagePullPolicy: "{{ .Values.retrain.image.pullPolicy }}"
          command: ["python", "retrain_incremental.py"]

          env:
            - name: MLFLOW_TRACKING_URI
              value: "https://mlflow.qmuit.id.vn"

            - name: MODEL_NAME
              value: "ARF Baseline Model"

            - name: S3_BUCKET
              value: "qmuit-ids-training-data-store"

            - name: AWS_DEFAULT_REGION
              value: "us-east-1"

        resources:
          limits:
            cpu: "{{ .Values.retrain.resources.cpu }}"
            memory: "{{ .Values.retrain.resources.memory }}"
